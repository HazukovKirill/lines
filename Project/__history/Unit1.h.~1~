//---------------------------------------------------------------------------

#ifndef Unit1H
#define Unit1H
//---------------------------------------------------------------------------
#include <System.Classes.hpp>
#include <Vcl.Controls.hpp>
#include <Vcl.StdCtrls.hpp>
#include <Vcl.Forms.hpp>
#include <Vcl.Grids.hpp>
#include <Vcl.ExtCtrls.hpp>
#include <Vcl.Graphics.hpp>
#include <Vcl.Imaging.pngimage.hpp>
#include <System.ImageList.hpp>
#include <Vcl.ImgList.hpp>
#include <Vcl.Buttons.hpp>
#include <Vcl.Menus.hpp>
#include <Vcl.Dialogs.hpp>
#include <Vcl.ExtDlgs.hpp>
#include <iostream>
#include <fstream>
#include <algorithm>
#include <vector>
#include <sstream>
#include <string>
#include <ctime>
#include "Cell.h"
#define CELLSIZE 68
#define OFFSETX 12
#define OFFSETY 11
#define BALLSCOUNT 7
#define WAYTOHELP "help.txt"
#define WAYTOREF "ref.txt"
using namespace std;
//---------------------------------------------------------------------------
class TForm1 : public TForm
{
__published:	// IDE-managed Components
	TTimer *Timer1;
	TTimer *Timer2;
	TLabel *Label1;
	TTimer *Timer3;
	TLabel *nextStep;
	TMainMenu *MainMenu1;
	TMenuItem *N1;
	TMenuItem *N2;
	TMenuItem *N4;
	TMenuItem *ItemMenuSaveGame;
	TOpenTextFileDialog *OpenTextFileDialog1;
	TMenuItem *N6;
	TMenuItem *ItemMenuRef;
	TMenuItem *ItemMenuHelp;
	TMenuItem *N8;
	TTimer *Timer4;
	void __fastcall Timer1Timer(TObject *Sender);
	void __fastcall Timer2Timer(TObject *Sender);
	void __fastcall Timer3Timer(TObject *Sender);
	void __fastcall nextStepClick(TObject *Sender);
	void __fastcall NewGame(TObject *Sender);
	void __fastcall ItemMenuSaveGameClick(TObject *Sender);
	void __fastcall ExitClick(TObject *Sender);
	void __fastcall LoadGameClick(TObject *Sender);
	void __fastcall ItemMenuHelpClick(TObject *Sender);
	void __fastcall ItemMenuRefClick(TObject *Sender);
	void __fastcall Timer4Timer(TObject *Sender);
private:	// User declarations
	Cell* _cells[9][9];
	Cell* _activeCell;
	vector<Cell*> _freeCells;
    TPicture* _actPctrs[2];
	TPicture* _ballPctrs[BALLSCOUNT];
	//--Animation--
	int _animCfSetBall;
	int _animCfDeleteBall;
	int _wayField[9][9];
	int _animIndxBallWay;
	int _animNBallWay;
	vector<Cell*> _animSetCells;
	vector<Cell*> _animDeleteCells;
	vector<Cell*> _wayCells;
	vector<Cell*> _animWay;
	vector<Cell*> _burst;
	Cell* _targetBall;
	//--Info--
	int _score;
	int _nextBalls[3];
    TImage* _nextBallsImgs[3];
public:		// User declarations
	__fastcall TForm1(TComponent* Owner);
    void InitPictures();
	void __fastcall PostClick(TObject*);
	bool GetWay(int,int,int,int);
	int ControlLines(int,int, int);
	int ControlLine(int, int, int, void(*f)(int&,int&,int));
	bool PutBalls();
	void SetBall(int, int, int, bool=false);
	void DeleteBall(int,int);
	void PutBall(int);
	void GameOver();
	int Burst(int,int,int);
	void BurstBalls();
	void InitCells();
	void GenNextBalls();
	void InitNextBallImgs();
	void SaveGame(string);
	void LoadGame(string);
	bool CheckFile(string);
    void ShowMessageByFile(string,string);
};
//---------------------------------------------------------------------------
extern PACKAGE TForm1 *Form1;
//---------------------------------------------------------------------------
#endif
